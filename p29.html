<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>长山隧道总体施工进度安排 - p29</title>
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #ffb700;
            --bg-dark: #0f172a;
            --panel-bg: #1e293b;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
            --header-height: 70px;
            --tabs-height: 50px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden; /* 禁止整体滚动 */
            display: flex;
            flex-direction: column;
        }

        /* --- 头部 --- */
        header {
            height: var(--header-height);
            background: linear-gradient(90deg, #0f172a 0%, #1e293b 100%);
            padding: 0 30px;
            border-bottom: 1px solid rgba(0, 242, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        h1 { font-size: 26px; font-weight: 300; letter-spacing: 1px; color: #fff; }
        h1 span { color: var(--primary); font-weight: 700; text-shadow: 0 0 10px rgba(0, 242, 255, 0.3); }
        
        .header-meta {
            text-align: right;
            font-size: 14px;
            color: var(--text-muted);
        }
        .header-meta strong { color: var(--success); }

        /* --- 导航 Tab --- */
        .tabs {
            height: var(--tabs-height);
            display: flex;
            gap: 2px;
            background: #1e293b;
            flex-shrink: 0;
        }
        
        .tab-btn {
            flex: 1;
            background: #334155;
            border: none;
            color: var(--text-muted);
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 3px solid transparent;
        }
        
        .tab-btn.active {
            background: #1e293b;
            color: var(--primary);
            font-weight: bold;
            border-bottom: 3px solid var(--primary);
        }
        
        .tab-btn:hover:not(.active) { background: #475569; }

        /* --- 内容区域 (自适应高度) --- */
        .content-container {
            flex: 1;
            position: relative;
            padding: 20px;
            overflow: hidden; /* 内部也不滚动，内容适配屏幕 */
        }

        .section {
            display: none;
            height: 100%;
            width: 100%;
            animation: fadeIn 0.4s ease;
        }
        
        .section.active { display: grid; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- 通用卡片 --- */
        .card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        .card-header {
            color: var(--secondary);
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- 第一页：总体演示 (上下布局) --- */
        #overview-section {
            grid-template-rows: 60% 40%;
            gap: 15px;
        }

        .simulation-area {
            position: relative;
            background: #0b1120;
            border-radius: 12px;
            border: 1px solid #334155;
            display: flex;
            flex-direction: column;
        }

        .sim-controls {
            height: 60px; /* 稍微增高以容纳醒目按钮 */
            background: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            border-top: 1px solid #334155;
        }

        .btn-ctrl {
            background: transparent;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 24px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: bold;
            font-size: 14px;
        }
        .btn-ctrl:hover { background: rgba(0, 242, 255, 0.1); box-shadow: 0 0 10px rgba(0,242,255,0.2); }
        .btn-ctrl:disabled { border-color: #64748b; color: #64748b; cursor: not-allowed; box-shadow: none; }

        /* 修改后的醒目样式 */
        .step-indicator {
            color: #0f172a; /* 深色文字，对比度高 */
            background: var(--primary); /* 醒目的青色背景 */
            padding: 8px 25px;
            border-radius: 20px; /* 圆角 */
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.6); /* 发光效果 */
            min-width: 450px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid #fff;
        }

        /* 底部文字信息网格 */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
        }
        .info-box {
            background: #1e293b;
            border-left: 4px solid var(--primary);
            padding: 15px;
            border-radius: 0 8px 8px 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        .info-box h3 { color: #fff; font-size: 16px; margin-bottom: 8px; }
        .info-box p { color: var(--text-muted); font-size: 13px; line-height: 1.5; }
        .info-box.highlight { background: rgba(0, 242, 255, 0.1); border-left-color: var(--secondary); box-shadow: inset 0 0 20px rgba(0, 242, 255, 0.05); }

        /* SVG 内部样式 */
        text { font-family: sans-serif; }
        .bar-transition { transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1); }

        /* --- 第二页：工效分析 (左右布局) --- */
        #efficiency-section {
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        
        .analysis-left { display: flex; flex-direction: column; gap: 15px; justify-content: center; }
        .analysis-right { display: flex; flex-direction: column; gap: 15px; }

        .rock-bar-container {
            margin: 20px 0;
        }
        .rock-bar {
            height: 35px;
            display: flex;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 5px;
            font-size: 12px;
            font-weight: bold;
            color: #000;
            line-height: 35px;
            text-align: center;
        }
        .rock-legend { display: flex; gap: 15px; font-size: 12px; color: var(--text-muted); margin-bottom: 5px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }

        .qa-box {
            background: rgba(255, 183, 0, 0.1);
            border: 1px solid rgba(255, 183, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .qa-box li { margin-bottom: 12px; font-size: 14px; color: #e2e8f0; line-height: 1.5; }

        /* --- 第三页：逻辑审查 --- */
        #logic-section {
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: center;
        }

        .logic-card {
            height: 80%;
            background: #1e293b;
            border-radius: 12px;
            padding: 30px;
            position: relative;
        }
        .logic-timeline {
            margin-top: 20px;
            padding-left: 20px;
            border-left: 2px dashed #475569;
        }
        .logic-item { position: relative; margin-bottom: 30px; }
        .logic-item::before {
            content: ''; position: absolute; left: -26px; top: 5px;
            width: 10px; height: 10px; background: var(--primary); border-radius: 50%;
        }
        .logic-date { color: var(--secondary); font-weight: bold; margin-bottom: 5px; }
        .logic-desc { color: var(--text-main); font-size: 15px; }
        .logic-note { color: var(--text-muted); font-size: 13px; margin-top: 3px; }

        /* 右下角署名样式 */
        .footer-credit {
            position: fixed;
            bottom: 10px;
            right: 20px;
            color: rgba(255, 255, 255, 0.5); /* 半透明灰白 */
            font-size: 12px;
            z-index: 1000;
            pointer-events: none;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            font-family: sans-serif;
        }

        /* --- 新增：悬浮导航按钮样式 --- */
        .nav-btn {
            position: fixed; bottom: 30px; padding: 12px 30px;
            background: #003366; /* CRCC Blue */
            color: white;
            border-radius: 30px; text-decoration: none; font-weight: bold;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); /* 深色阴影适配暗色主题 */
            transition: 0.3s; z-index: 9999; font-size: 1rem;
            font-family: "Microsoft YaHei", sans-serif;
        }
        .nav-btn:hover { background: #E60012; transform: scale(1.05); }
        .prev-btn { right: 150px; background: rgba(255,255,255,0.9); color: #003366; border: 1px solid #003366; }
        .prev-btn:hover { color: white; border-color: #E60012; background: #E60012; }
        .next-btn { right: 30px; }

    </style>
</head>
<body>

<header>
    <h1>长山隧道 <span>总体施工进度安排</span></h1>
    <div class="header-meta">
        总工期: <strong>721天 (24个月)</strong> <br>
        起止: 2025/11/01 - 2027/10/23
    </div>
</header>

<div class="tabs">
    <button class="tab-btn active" onclick="switchTab('overview-section', this)">一、总体进度演示</button>
    <button class="tab-btn" onclick="switchTab('efficiency-section', this)">二、工效深度分析</button>
    <button class="tab-btn" onclick="switchTab('logic-section', this)">三、逻辑审查</button>
</div>

<div class="content-container">

    <div id="overview-section" class="section active">
        <div class="simulation-area">
            <div style="flex:1; overflow: hidden; position: relative;">
                <svg width="100%" height="100%" viewBox="0 0 1200 400" preserveAspectRatio="xMidYMid meet" id="main-svg">
                    <defs>
                        <pattern id="grid" width="100" height="100" patternUnits="userSpaceOnUse">
                            <line x1="0" y1="0" x2="0" y2="100" stroke="#334155" stroke-width="1" stroke-dasharray="5,5"/>
                        </pattern>
                        <linearGradient id="unexcavated" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style="stop-color:#1e293b;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#334155;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <rect width="100%" height="100%" fill="#0b1120" />
                    <rect width="100%" height="100%" fill="url(#grid)" opacity="0.5"/>

                    <line x1="100" y1="350" x2="1100" y2="350" stroke="#64748b" stroke-width="2"/>
                    <text x="100" y="370" fill="#64748b" font-size="14" text-anchor="middle">2025/11</text>
                    <text x="350" y="370" fill="#64748b" font-size="14" text-anchor="middle">2026/05</text>
                    <text x="600" y="370" fill="#64748b" font-size="14" text-anchor="middle">2026/11</text>
                    <text x="850" y="370" fill="#64748b" font-size="14" text-anchor="middle">2027/05</text>
                    <text x="1100" y="370" fill="#64748b" font-size="14" text-anchor="middle">2027/10</text>

                    <g transform="translate(0, 80)">
                        <text x="90" y="35" fill="#fff" font-size="18" text-anchor="end" font-weight="bold">左线</text>
                        <rect x="100" y="0" width="1000" height="70" fill="url(#unexcavated)" rx="5"/>
                        <text x="1110" y="35" fill="#94a3b8" font-size="14">615.8m</text>
                        
                        <rect id="left-ex-bar" class="bar-transition" x="100" y="5" width="0" height="60" fill="#fbbf24" rx="4" opacity="0.9"/>
                        <rect id="left-lin-bar" class="bar-transition" x="100" y="20" width="0" height="30" fill="#10b981" rx="2" opacity="1"/>
                        
                        <text id="left-label" x="120" y="40" fill="#000" font-size="14" font-weight="bold" opacity="0"></text>
                    </g>

                    <g transform="translate(0, 220)">
                        <text x="90" y="35" fill="#fff" font-size="18" text-anchor="end" font-weight="bold">右线</text>
                        <rect x="100" y="0" width="940" height="70" fill="url(#unexcavated)" rx="5"/> <text x="1050" y="35" fill="#94a3b8" font-size="14">579.3m</text>
                        
                        <rect id="right-ex-bar" class="bar-transition" x="100" y="5" width="0" height="60" fill="#fbbf24" rx="4" opacity="0.9"/>
                        <rect id="right-lin-bar" class="bar-transition" x="100" y="20" width="0" height="30" fill="#10b981" rx="2" opacity="1"/>
                        
                        <text id="right-label" x="120" y="40" fill="#000" font-size="14" font-weight="bold" opacity="0"></text>
                    </g>

                    <line id="time-cursor" class="bar-transition" x1="100" y1="50" x2="100" y2="350" stroke="#00f2ff" stroke-width="2" stroke-dasharray="4,4" opacity="0"/>
                    <text id="current-date-text" x="100" y="40" fill="#00f2ff" font-size="16" text-anchor="middle" font-weight="bold"></text>

                </svg>
                
                <div style="position:absolute; top:10px; right:20px; background:rgba(0,0,0,0.7); padding:10px; border-radius:4px; font-size:12px;">
                    <div style="display:flex;align-items:center;margin-bottom:5px;"><span style="width:12px;height:12px;background:#fbbf24;margin-right:5px;border-radius:2px;"></span> 开挖及初支</div>
                    <div style="display:flex;align-items:center;"><span style="width:12px;height:12px;background:#10b981;margin-right:5px;border-radius:2px;"></span> 二衬及仰拱</div>
                </div>
            </div>

            <div class="sim-controls">
                <button class="btn-ctrl" onclick="changeStep(-1)" id="btn-prev">
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg> 
                    上一步
                </button>
                <div class="step-indicator" id="step-desc">准备就绪：点击“下一步”开始推演</div>
                <button class="btn-ctrl" onclick="changeStep(1)" id="btn-next">
                    下一步 
                    <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
                </button>
            </div>
        </div>

        <div class="info-grid">
            <div class="info-box" id="info-1">
                <h3>1. 工法决定工期</h3>
                <p>V级/IV级软岩占比超90%，且V级采用CRD法。按综合月进尺35~40m测算，左线耗时485天，右线耗时455天。工序转换和破碎带处理时间已充分考虑。</p>
            </div>
            <div class="info-box" id="info-2">
                <h3>2. 安全步距控制</h3>
                <p>仰拱滞后开挖约25天，二衬滞后约45天。收尾阶段二衬完工晚于贯通1.5个月，完全符合软弱围岩“二衬紧跟”的安全规范。</p>
            </div>
            <div class="info-box" id="info-3">
                <h3>3. 左右洞干扰排除</h3>
                <p>右洞滞后左洞约2.5个月进洞（2026/3/22），利用左洞先行探明地质，并错开出渣高峰期，实现资源最优配置。</p>
            </div>
            <div class="info-box" id="info-4">
                <h3>4. 路面与附属工程</h3>
                <p>水沟电缆槽在二衬后穿插进行（2026/12/20开始）。总工期控制在24个月（721天），既满足业主要求，也符合高风险施工规律。</p>
            </div>
        </div>
    </div>

    <div id="efficiency-section" class="section">
        <div class="analysis-left">
            <div class="card">
                <div class="card-header">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    左线 (615.879m) 工效测算 - 总计485天
                </div>
                <div class="rock-legend">
                    <span><span class="dot" style="background:#ef4444"></span>V级围岩 (46%)</span>
                    <span><span class="dot" style="background:#f59e0b"></span>IV级围岩 (44%)</span>
                    <span><span class="dot" style="background:#10b981"></span>III级围岩 (10%)</span>
                </div>
                <div class="rock-bar-container">
                    <div class="rock-bar">
                        <div style="width: 46%; background: #ef4444;">V级 (CRD法) 286m</div>
                        <div style="width: 44%; background: #f59e0b;">IV级 (CD法) 270m</div>
                        <div style="width: 10%; background: #10b981;">III级 60m</div>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; font-size:13px;">
                    <div><strong>V级:</strong> 0.9m/天 (耗时318天)<br><span style="color:#94a3b8">CRD法工序繁琐</span></div>
                    <div><strong>IV级:</strong> 2.0m/天 (耗时135天)<br><span style="color:#94a3b8">CD法立中隔壁</span></div>
                    <div><strong>III级:</strong> 3.5m/天 (耗时17天)<br><span style="color:#94a3b8">台阶法快速推进</span></div>
                </div>
                <div style="margin-top:15px; padding-top:10px; border-top:1px solid #334155; font-size:14px;">
                    <strong>综合指标：</strong> 理论工期 470天 vs 计划工期 <span style="color:var(--primary); font-size:18px;">485天</span>
                    <span style="float:right; color:var(--success)">预留15天机动时间</span>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                    右线 (579.352m) 工效测算 - 总计455天
                </div>
                <div class="rock-bar-container">
                    <div class="rock-bar">
                        <div style="width: 44%; background: #ef4444;">V级 254m</div>
                        <div style="width: 46%; background: #f59e0b;">IV级 265m</div>
                        <div style="width: 10%; background: #10b981;">III级 60m</div>
                    </div>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px; font-size:13px;">
                    <div><strong>V级:</strong> 0.9m/天 (耗时282天)</div>
                    <div><strong>IV级:</strong> 2.0m/天 (耗时133天)</div>
                    <div><strong>III级:</strong> 3.5m/天 (耗时17天)</div>
                </div>
                <div style="margin-top:15px; padding-top:10px; border-top:1px solid #334155; font-size:14px;">
                    <strong>综合指标：</strong> 理论工期 432天 vs 计划工期 <span style="color:var(--primary); font-size:18px;">455天</span>
                    <span style="float:right; color:var(--success)">预留23天机动时间 (应对出渣干扰)</span>
                </div>
            </div>
        </div>

        <div class="analysis-right">
            <div class="qa-box">
                <p style="margin-bottom:15px; font-size:18px; font-weight:bold; color:var(--secondary); border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom:10px;">
                    Q: 开挖485天是否过长？
                </p>
                <ul>
                    <li><strong>地质制约：</strong> 软岩占比超90%，V级围岩必须采用CRD法，日进尺仅0.9m，这是硬性物理指标。</li>
                    <li><strong>数据支撑：</strong> 286m / 0.9 + 270m / 2.0 = 453天，仅这两项已占据绝大部分工期。</li>
                    <li><strong>合理冗余：</strong> 考虑到CRD转CD法需要拆改钢架，以及设备检修，预留15天是必须的风险缓冲。</li>
                    <li><strong>平均工效：</strong> 全隧平均1.27m/天，在软岩隧道中属于安全且合理的区间。</li>
                </ul>
            </div>
        </div>
    </div>

    <div id="logic-section" class="section">
        <div class="logic-card">
            <div class="card-header">平行流水作业逻辑 (Project验证)</div>
            <div class="logic-timeline">
                <div class="logic-item">
                    <div class="logic-date">2027/5/4</div>
                    <div class="logic-desc">左线开挖贯通</div>
                    <div class="logic-note">此时二衬仍在进行，未完工</div>
                </div>
                <div class="logic-item">
                    <div class="logic-date" style="color:var(--success)">2027/6/21 (+48天)</div>
                    <div class="logic-desc">左线二衬完工</div>
                    <div class="logic-note">滞后开挖约1.5个月，给围岩变形预留时间，符合规范</div>
                </div>
                <div class="logic-item">
                    <div class="logic-date">2027/6/20</div>
                    <div class="logic-desc">右线开挖贯通</div>
                </div>
                <div class="logic-item">
                    <div class="logic-date" style="color:var(--success)">2027/8/5 (+46天)</div>
                    <div class="logic-desc">右线二衬完工</div>
                    <div class="logic-note">同样滞后1.5个月，逻辑一致</div>
                </div>
            </div>
        </div>

        <div class="logic-card">
            <div class="card-header">洞门与收尾逻辑</div>
            <div class="logic-timeline">
                <div class="logic-item">
                    <div class="logic-date">2027/8/5</div>
                    <div class="logic-desc">主体工程（开挖/二衬）全部结束</div>
                </div>
                <div class="logic-item">
                    <div class="logic-date" style="color:var(--primary)">2027/8/5 - 10/6 (62天)</div>
                    <div class="logic-desc">洞门施工 / 明洞回填</div>
                    <div class="logic-note">安排在洞内主体完工后，避免干扰洞内运输</div>
                </div>
                <div class="logic-item">
                    <div class="logic-date">2027/10/23</div>
                    <div class="logic-desc">全线竣工</div>
                    <div class="logic-note">包含绿化、清理及撤场时间</div>
                </div>
            </div>
        </div>
    </div>

</div>

<div class="footer-credit">制作：张建</div>

<a href="p28.html" class="nav-btn prev-btn">上一页</a>
<a href="p30.html" class="nav-btn next-btn">下一页</a>

<script>
    // Tab 切换逻辑
    function switchTab(sectionId, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        btn.classList.add('active');
    }

    // 演示逻辑
    // 总宽度 1000px 代表约 721 天
    // 起点: 2025-11-01 (x=100)
    // 终点: 2027-10-23 (x=1100)
    // 比例: 1000px / 721天 ≈ 1.38 px/day
    
    const startDate = new Date("2025-11-01").getTime();
    
    function getXByDate(dateStr) {
        const d = new Date(dateStr).getTime();
        const diffDays = (d - startDate) / (1000 * 3600 * 24);
        return 100 + (diffDays * 1.38);
    }
    
    function getWidthByDate(startStr, endStr) {
        const start = getXByDate(startStr);
        const end = getXByDate(endStr);
        return end - start;
    }

    // 关键时间节点定义 (严格对标横道图)
    const steps = [
        {
            date: "2025/11/01",
            desc: "第1步：全线开工，左洞洞口工程启动",
            leftExEnd: "2025/11/01", leftLinEnd: "2025/11/01",
            rightExEnd: "2025/11/01", rightLinEnd: "2025/11/01",
            highlight: ""
        },
        {
            date: "2026/01/04",
            desc: "第2步：左洞进洞 (V级围岩CRD法，进度缓慢)",
            leftExEnd: "2026/01/04", leftLinEnd: "2026/01/04",
            rightExEnd: "2025/11/01", rightLinEnd: "2025/11/01",
            highlight: "info-1"
        },
        {
            date: "2026/03/22",
            desc: "第3步：右洞进洞 (错峰施工，滞后左洞约2.5个月)",
            leftExEnd: "2026/03/22", leftLinEnd: "2026/02/21", // 左二衬开始
            rightExEnd: "2026/03/22", rightLinEnd: "2026/03/22",
            highlight: "info-3"
        },
        {
            date: "2026/12/20",
            desc: "第4步：中期掘进 & 附属工程穿插 (水沟电缆槽)",
            leftExEnd: "2026/12/20", leftLinEnd: "2026/11/10",
            rightExEnd: "2026/11/10", rightLinEnd: "2026/10/01",
            highlight: "info-4"
        },
        {
            date: "2027/05/04",
            desc: "第5步：左幅率先贯通 (右幅剩余约1.5个月)",
            // 此时左线开挖满，右线开挖还在进行中
            leftExEnd: "2027/05/04", leftLinEnd: "2027/04/01",
            rightExEnd: "2027/04/15", rightLinEnd: "2027/03/01",
            highlight: "info-1"
        },
        {
            date: "2027/06/20",
            desc: "第6步：右幅后续贯通 (滞后左幅47天，符合逻辑)",
            // 此时双线开挖均满
            leftExEnd: "2027/05/04", leftLinEnd: "2027/06/15",
            rightExEnd: "2027/06/20", rightLinEnd: "2027/05/10",
            highlight: "info-2"
        },
        {
            date: "2027/08/05",
            desc: "第7步：右洞二衬完工 / 洞门施工启动",
            leftExEnd: "2027/05/04", leftLinEnd: "2027/06/21",
            rightExEnd: "2027/06/20", rightLinEnd: "2027/08/05",
            highlight: "info-2"
        },
        {
            date: "2027/10/23",
            desc: "第8步：全线竣工 (洞门及绿化完成)",
            leftExEnd: "2027/05/04", leftLinEnd: "2027/06/21",
            rightExEnd: "2027/06/20", rightLinEnd: "2027/08/05",
            highlight: "info-4" // 完工状态
        }
    ];

    // 隧道总长度对应的像素宽
    // 左线 615.8m -> 1000px wide rect for logic visual
    // 右线 579.3m -> 940px wide rect
    const leftTunnelPx = 1000;
    const rightTunnelPx = 940;

    let currentStep = 0;

    function renderStep(idx) {
        const step = steps[idx];
        
        // 更新文字
        document.getElementById('step-desc').textContent = step.desc;
        document.getElementById('current-date-text').textContent = step.date;
        
        // 高亮 Info Box
        document.querySelectorAll('.info-box').forEach(b => b.classList.remove('highlight'));
        if(step.highlight) document.getElementById(step.highlight).classList.add('highlight');

        // 计算光标位置
        const cursorX = getXByDate(step.date);
        const cursorLine = document.getElementById('time-cursor');
        cursorLine.setAttribute('x1', cursorX);
        cursorLine.setAttribute('x2', cursorX);
        cursorLine.setAttribute('opacity', idx === 0 ? 0 : 1);
        document.getElementById('current-date-text').setAttribute('x', cursorX);
        document.getElementById('current-date-text').setAttribute('opacity', idx === 0 ? 0 : 1);

        // 计算左线进度
        updateBar('left-ex-bar', 'left-label', "2026/01/04", "2027/05/04", step.date, leftTunnelPx, "开挖中");
        updateBar('left-lin-bar', null, "2026/02/21", "2027/06/21", step.date, leftTunnelPx, "");

        // 计算右线进度
        updateBar('right-ex-bar', 'right-label', "2026/03/22", "2027/06/20", step.date, rightTunnelPx, "开挖中");
        updateBar('right-lin-bar', null, "2026/05/07", "2027/08/05", step.date, rightTunnelPx, "");

        // 按钮状态
        document.getElementById('btn-prev').disabled = (idx === 0);
        document.getElementById('btn-next').disabled = (idx === steps.length - 1);
    }

    function updateBar(barId, labelId, startStr, endStr, currentStr, maxPx, labelText) {
        const start = new Date(startStr).getTime();
        const end = new Date(endStr).getTime();
        const current = new Date(currentStr).getTime();
        
        let width = 0;
        if (current < start) {
            width = 0;
        } else if (current >= end) {
            width = maxPx;
        } else {
            const pct = (current - start) / (end - start);
            width = maxPx * pct;
        }
        
        document.getElementById(barId).setAttribute('width', width);
        
        if(labelId) {
            const label = document.getElementById(labelId);
            if (current < start) {
                label.setAttribute('opacity', 0);
            } else if (current >= end) {
                label.setAttribute('x', 100 + maxPx + 10);
                label.textContent = "已贯通";
                label.setAttribute('opacity', 1);
                label.setAttribute('fill', '#10b981');
            } else {
                label.setAttribute('x', 100 + width + 10);
                label.textContent = labelText;
                label.setAttribute('opacity', 1);
                label.setAttribute('fill', '#fbbf24');
            }
        }
    }

    function changeStep(dir) {
        const newStep = currentStep + dir;
        if(newStep >= 0 && newStep < steps.length) {
            currentStep = newStep;
            renderStep(currentStep);
        }
    }

    // 初始化
    renderStep(0);

</script>
</body>
</html>