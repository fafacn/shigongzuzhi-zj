<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢„åˆ¶æ¢æ¶è®¾æ€»ä½“æ–½å·¥æ–¹æ¡ˆ - p18</title>
    <style>
        /* --- 1. æ ¸å¿ƒé…è‰² --- */
        :root {
            --crcc-blue: #003366;
            --crcc-red: #E60012;
            --phase1-color: #e53e3e; /* çº¢ï¼šç¬¬ä¸€é˜¶æ®µ */
            --phase2-color: #3182ce; /* è“ï¼šç¬¬äºŒé˜¶æ®µ */
            --beam-yard-bg: #f6ad55; /* æ¢åœºé»„ */
            --text-main: #1a202c;
            --bg-grad: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Microsoft YaHei", "PingFang SC", sans-serif;
            height: 100vh; width: 100vw; overflow: hidden;
            background: var(--bg-grad);
            display: flex; justify-content: center; align-items: center;
            color: var(--text-main);
        }

        .container {
            width: 98vw; height: 96vh;
            display: flex; flex-direction: column;
            padding: 20px;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(15px);
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        /* --- æ ‡é¢˜åŒº --- */
        .header-section {
            flex: 0 0 auto;
            border-bottom: 2px solid rgba(0, 51, 102, 0.1);
            padding-bottom: 10px; margin-bottom: 10px;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        h2 { font-size: 1.8rem; color: var(--crcc-blue); display: flex; align-items: center; gap: 10px; margin: 0; }
        h2::before { content:''; width: 6px; height: 28px; background: var(--crcc-red); display: block; }
        .legend-box { display: flex; gap: 15px; font-size: 0.85rem; }
        .l-item { display: flex; align-items: center; gap: 5px; }
        .l-dot { width: 10px; height: 10px; border-radius: 50%; }

        /* --- æ ¸å¿ƒå¸ƒå±€ --- */
        .main-content {
            flex: 1; display: flex; flex-direction: column; gap: 15px; overflow: hidden;
        }

        /* 1. å…¨æ™¯é•¿å· (ä¸Šéƒ¨) */
        .panorama-scroll-view {
            flex: 2; /* å æ®è¾ƒå¤§ç©ºé—´ */
            background: #fff;
            border: 1px solid #cbd5e0;
            border-radius: 10px;
            overflow-x: auto;
            overflow-y: hidden;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
        }
        
        .panorama-scroll-view::-webkit-scrollbar { height: 10px; }
        .panorama-scroll-view::-webkit-scrollbar-thumb { background: #cbd5e0; border-radius: 5px; }
        .panorama-scroll-view::-webkit-scrollbar-track { background: #f7fafc; }

        #detailMapSvg { height: 100%; }

        /* 2. ç­–ç•¥æ§åˆ¶å° (ä¸‹éƒ¨) */
        .strategy-dashboard {
            flex: 1; min-height: 220px;
            display: grid; grid-template-columns: 1fr 1fr 300px; gap: 15px;
        }

        .dash-card {
            background: rgba(255,255,255,0.6); border: 1px solid #fff;
            border-radius: 8px; padding: 15px;
            display: flex; flex-direction: column;
            box-shadow: 0 2px 10px rgba(0,0,0,0.02);
        }

        .dc-title { 
            font-weight: bold; color: var(--crcc-blue); margin-bottom: 10px; 
            border-bottom: 1px dashed #cbd5e0; padding-bottom: 5px;
            display: flex; justify-content: space-between;
        }
        .dc-content { font-size: 0.9rem; color: #4a5568; line-height: 1.6; overflow-y: auto; flex: 1; }
        
        .hl-red { color: #c53030; font-weight: bold; }
        .hl-blue { color: #2b6cb0; font-weight: bold; }
        .tag { padding: 1px 5px; border-radius: 3px; font-size: 0.8rem; background: #edf2f7; color: #4a5568; border: 1px solid #cbd5e0; margin-right: 5px;}

        /* Tooltip */
        .svg-tooltip {
            position: absolute; display: none;
            background: rgba(0, 0, 0, 0.85); color: white;
            padding: 8px 12px; border-radius: 4px; font-size: 12px;
            pointer-events: none; white-space: nowrap; z-index: 1000;
        }

        /* å¯¼èˆªæŒ‰é’® */
        .nav-btn {
            position: fixed; bottom: 30px; padding: 10px 25px;
            background: var(--crcc-blue); color: white;
            border-radius: 30px; text-decoration: none; font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); transition: 0.3s; z-index: 200; font-size: 0.9rem;
        }
        .nav-btn:hover { background: var(--crcc-red); }
        .prev-btn { right: 150px; background: white; color: var(--crcc-blue); border: 1px solid var(--crcc-blue); }
        .next-btn { right: 30px; }

    </style>
</head>
<body>

<div class="container">
    <div class="header-section">
        <h2>å…¨çº¿æ¡¥æ¶µåˆ†å¸ƒåŠæ¶æ¢é¡ºåºæ¨æ¼” (K15+236 ~ K41+105)</h2>
        <div class="legend-box">
            <div class="l-item"><div class="l-dot" style="background:var(--beam-yard-bg)"></div>æ¢åœºæ ¸å¿ƒåŒº</div>
            <div class="l-item"><div class="l-dot" style="background:var(--phase1-color)"></div>ç¬¬ä¸€é˜¶æ®µ(æ”»åš)</div>
            <div class="l-item"><div class="l-dot" style="background:var(--phase2-color)"></div>ç¬¬äºŒé˜¶æ®µ(æŒä¹…)</div>
            <div class="l-item">â­•ï¸åœ†ç®¡æ¶µ ğŸ“¦ç®±æ¶µ ğŸŒ‰å¤©æ¡¥</div>
        </div>
    </div>

    <div class="main-content">
        <!-- ä¸Šéƒ¨ï¼šå…¨æ™¯é•¿å· -->
        <div class="panorama-scroll-view">
            <svg id="detailMapSvg"></svg>
            <div id="tooltip" class="svg-tooltip"></div>
            <div style="position:absolute; bottom:10px; right:20px; background:rgba(0,0,0,0.1); padding:5px 10px; border-radius:20px; font-size:12px; color:#666; pointer-events:none;">
                æŒ‰ä½ Shift + æ»šè½® æˆ– æ‹–åŠ¨ä¸‹æ–¹æ»šåŠ¨æ¡æŸ¥çœ‹å…¨çº¿ â®•
            </div>
        </div>

        <!-- ä¸‹éƒ¨ï¼šç­–ç•¥æ§åˆ¶å° -->
        <div class="strategy-dashboard">
            <!-- ç¬¬ä¸€é˜¶æ®µ -->
            <div class="dash-card" style="border-top: 3px solid var(--phase1-color);">
                <div class="dc-title">
                    <span>ğŸš© ç¬¬ä¸€é˜¶æ®µï¼šå°é‡Œç¨‹æ”»åš (K26â†’K15)</span>
                    <span style="color:var(--phase1-color)">826ç‰‡æ¢ (68%)</span>
                </div>
                <div class="dc-content">
                    <p><strong>1. é¦–æ¶å³å†³æˆ˜ï¼š</strong><br>æ¢åœºå‡ºå£å³ä¸º<span class="hl-red">K26+065ä¸Šè·¨S213ç‰¹å¤§æ¡¥</span>ï¼ˆå…¨çº¿å”¯ä¸€ç‰¹å¤§æ¡¥ï¼‰ã€‚æ¶æ¡¥æœºéœ€åœ¨æ­¤å®Œæˆæ‹¼è£…ã€é¦–æ¶åŠ25/35/40må˜è·¨ä½œä¸šã€‚</p>
                    <p style="margin-top:8px;"><strong>2. å¯†é›†æ¶è®¾ï¼š</strong><br>K16-K18æ®µé›†ä¸­åˆ†å¸ƒ3åº§ä¸­æ¡¥ï¼ˆå‡ä¸º3x13mï¼‰ï¼Œç”±äºè·¨å¾„å°ï¼Œå»ºè®®é‡‡ç”¨<span class="hl-red">100tæ±½è½¦åŠ</span>é…åˆæ¶è®¾ï¼Œæé«˜æ•ˆç‡ã€‚</p>
                </div>
            </div>

            <!-- ç¬¬äºŒé˜¶æ®µ -->
            <div class="dash-card" style="border-top: 3px solid var(--phase2-color);">
                <div class="dc-title">
                    <span>ğŸšš ç¬¬äºŒé˜¶æ®µï¼šå¤§é‡Œç¨‹é•¿é©± (K27â†’K41)</span>
                    <span style="color:var(--phase2-color)">258ç‰‡æ¢ (32%)</span>
                </div>
                <div class="dc-content">
                    <p><strong>1. è¶…é•¿è¿è·æŒ‘æˆ˜ï¼š</strong><br>K31+652è‡³K38+533ä¹‹é—´æ— ä¸»çº¿æ¡¥ï¼Œè·¯åŸºæ®µé•¿è¾¾<span class="hl-blue">7å…¬é‡Œ</span>ã€‚éœ€ç©¿è¶Š52é“æ¶µæ´åŠ6åº§å¤©æ¡¥ï¼Œè¿æ¢é€šé“ç»´æŠ¤æ˜¯å…³é”®ã€‚</p>
                    <p style="margin-top:8px;"><strong>2. å…³é”®èŠ‚ç‚¹ä¿®æ­£ï¼š</strong><br><span class="hl-blue">K31+652æ¸…æºªäºŒçº§å¹²æ¸ ä¸­æ¡¥</span>åŠ<span class="hl-blue">K38+533å·¨å…´äºŒçº§æ”¯æ¸ ä¸­æ¡¥</span>å‡ä¸º3x13mç»“æ„ã€‚éš¾åº¦é™ä½ï¼Œå¯é‡‡ç”¨åŠè½¦å…ˆè¡Œæ¶è®¾ï¼Œæ‰“é€šè¿æ¢é€šé“ã€‚</p>
                </div>
            </div>

            <!-- ä¿éšœæªæ–½ -->
            <div class="dash-card" style="background:#f7fafc;">
                <div class="dc-title">ğŸ›¡ï¸ è¿æ¢é€šé“ä¸è®¾å¤‡</div>
                <div class="dc-content">
                    <div style="display:flex; gap:10px; margin-bottom:8px;">
                        <span class="tag">æ¶æ¡¥æœº</span> JQJ-180t (å˜è·¨å‹)
                    </div>
                    <div style="display:flex; gap:10px; margin-bottom:8px;">
                        <span class="tag">è¿æ¢è½¦</span> 2å° 180t (ä¿é•¿è¿è·)
                    </div>
                    <hr style="border:0; border-top:1px dashed #ddd; margin:8px 0;">
                    <p><strong>è¿æ¢ä¾¿é“ï¼š</strong>é’ˆå¯¹K31-K38é•¿è·¯åŸºæ®µï¼Œæ¶µé¡¶å¡«åœŸ<1må¤„é“ºè®¾é’¢æ¿ï¼›è·¯åŸºè¡¨é¢é“ºç¢çŸ³ç›²æ²Ÿé˜²æ­¢é›¨åè½¯å¼¹ã€‚</p>
                </div>
            </div>
        </div>
    </div>
</div>

<a href="p17.html" class="nav-btn prev-btn">ä¸Šä¸€é¡µ</a>
<a href="p19.html" class="nav-btn next-btn">ä¸‹ä¸€é¡µ</a>

<script>
    // --- æ•°æ®æº ---
    const CONFIG = {
        minK: 15000,
        maxK: 41200,
        svgWidth: 2600,
        svgHeight: 320,
        centerY: 180,
        yardStart: 26700,
        yardEnd: 27900
    };

    // beams å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°ç»„ï¼ˆç”¨äºå¤šè¡Œæ˜¾ç¤ºï¼‰
    const DATA = [
        { type: 'node', k: 15236, label: "èµ·ç‚¹ K15+236", icon: 'start' },
        { type: 'road', len: 1542, info: {pipe:9, box:4, bridge:2} },
        { type: 'bridge', k: 16778, name: "ä¸Šè·¨Y01Gä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'road', len: 1074, info: {pipe:7, box:3, bridge:0} },
        { type: 'bridge', k: 17852, name: "ä¸Šè·¨Y003ä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'bridge', k: 18188, name: "K18+188ä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'road', len: 2555, info: {pipe:14, box:8, bridge:2} },
        { type: 'bridge', k: 20743, name: "ä¸Šè·¨Y045ä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'road', len: 1982, info: {pipe:6, box:4, bridge:2} },
        { type: 'bridge', k: 22725, name: "K22+725å°æ¡¥", desc: "2x13m PCçŸ®Tæ¢", beams: "44ç‰‡ 13mT" },
        { type: 'road', len: 1559, info: {pipe:3, box:4, bridge:1} },
        { type: 'bridge', k: 24284, name: "ä¸Šè·¨è€S213ä¸­æ¡¥", desc: "3x25m PCå°ç®±æ¢", beams: "30ç‰‡ 25mç®±" },
        { type: 'road', len: 1781, info: {pipe:3, box:5, bridge:0} },
        
        // ç‰¹å¤§æ¡¥æ•°æ®å¤šè¡Œç»†åŒ–
        { type: 'bridge', k: 26065, name: "ä¸Šè·¨S213ç‰¹å¤§æ¡¥", desc: "å˜è·¨å¤æ‚ç»“æ„", beams: ["448ç‰‡ 25mç®±", "40ç‰‡ 35mç®±", "10ç‰‡ 40mç®±"], isMajor: true },
        
        { type: 'yard', kStart: 26700, kEnd: 27900, info: {pipe:8, box:2, bridge:2}, label: "æ¢åœº K26+700~K27+900" },
        
        { type: 'bridge', k: 27971, name: "K27+971ä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'road', len: 3047, info: {pipe:18, box:6, bridge:0} },
        { type: 'bridge', k: 31018, name: "ä¹è¿æ”¯æ¸ å¤§æ¡¥", desc: "6x25m PCå°ç®±æ¢", beams: "60ç‰‡ 25mç®±", isMajor: true },
        { type: 'bridge', k: 31652, name: "æ¸…æºªäºŒçº§å¹²æ¸ ä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'road', len: 6881, info: {pipe:36, box:18, bridge:6}, isLong: true },
        { type: 'bridge', k: 38533, name: "å·¨å…´äºŒçº§æ”¯æ¸ ä¸­æ¡¥", desc: "3x13m PCçŸ®Tæ¢", beams: "66ç‰‡ 13mT" },
        { type: 'road', len: 1993, info: {pipe:7, box:6, bridge:1} },
        { type: 'node', k: 40526, label: "éš§é“è¿›å£ K40+526", icon: 'tunnel' }
    ];

    function renderMap() {
        const svg = document.getElementById('detailMapSvg');
        const tooltip = document.getElementById('tooltip');
        svg.setAttribute('width', CONFIG.svgWidth);
        svg.setAttribute('viewBox', `0 0 ${CONFIG.svgWidth} ${CONFIG.svgHeight}`);

        const getX = (k) => 50 + (k - CONFIG.minK) / (CONFIG.maxK - CONFIG.minK) * (CONFIG.svgWidth - 100);

        let html = '';

        // --- 1. èƒŒæ™¯ä¸»è½´ ---
        html += `<line x1="20" y1="${CONFIG.centerY}" x2="${CONFIG.svgWidth-20}" y2="${CONFIG.centerY}" stroke="#e2e8f0" stroke-width="4" stroke-linecap="round" />`;

        // --- 2. åŠ¨æ€æµå…‰è·¯å¾„ ---
        const yardLX = getX(CONFIG.yardStart);
        const startX = getX(CONFIG.minK);
        const yardRX = getX(CONFIG.yardEnd);
        const endX = getX(CONFIG.maxK);

        html += `
            <defs>
                <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="0" refY="3" orient="auto">
                    <path d="M0,3 L9,6 L9,0 z" fill="var(--phase1-color)" />
                </marker>
                <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <path d="M0,0 L0,6 L9,3 z" fill="var(--phase2-color)" />
                </marker>
                <pattern id="diagonalHatch" width="10" height="10" patternTransform="rotate(45 0 0)" patternUnits="userSpaceOnUse">
                    <line x1="0" y1="0" x2="0" y2="10" style="stroke:#f6ad55; stroke-width:1" />
                </pattern>
            </defs>

            <!-- å·¦å‘æµå…‰ (çº¢è‰²) - å‘å·¦æµåŠ¨ -->
            <line x1="${yardLX}" y1="${CONFIG.centerY}" x2="${startX}" y2="${CONFIG.centerY}" 
                stroke="var(--phase1-color)" stroke-width="4" stroke-opacity="0.3" />
            <line x1="${yardLX}" y1="${CONFIG.centerY}" x2="${startX}" y2="${CONFIG.centerY}" 
                stroke="var(--phase1-color)" stroke-width="4" stroke-dasharray="20,10">
                <animate attributeName="stroke-dashoffset" from="30" to="0" dur="0.5s" repeatCount="indefinite" />
            </line>

            <!-- å³å‘æµå…‰ (è“è‰²) - å‘å³æµåŠ¨ -->
            <line x1="${yardRX}" y1="${CONFIG.centerY}" x2="${endX}" y2="${CONFIG.centerY}" 
                stroke="var(--phase2-color)" stroke-width="4" stroke-opacity="0.3" />
            <line x1="${yardRX}" y1="${CONFIG.centerY}" x2="${endX}" y2="${CONFIG.centerY}" 
                stroke="var(--phase2-color)" stroke-width="4" stroke-dasharray="20,10">
                <animate attributeName="stroke-dashoffset" from="30" to="0" dur="0.5s" repeatCount="indefinite" />
            </line>
        `;

        // --- 3. åˆ»åº¦ ---
        for(let k = 15; k <= 41; k++) {
            const x = getX(k * 1000);
            html += `<line x1="${x}" y1="${CONFIG.centerY-5}" x2="${x}" y2="${CONFIG.centerY+5}" stroke="#cbd5e0" stroke-width="2" />`;
            html += `<text x="${x}" y="${CONFIG.centerY+25}" font-size="12" fill="#a0aec0" text-anchor="middle">K${k}</text>`;
        }

        // --- 4. æ¢åœº (æ•°æ®ä¿®æ­£) ---
        html += `
            <rect x="${yardLX}" y="${CONFIG.centerY-40}" width="${yardRX-yardLX}" height="80" fill="rgba(246, 173, 85, 0.2)" />
            <rect x="${yardLX}" y="${CONFIG.centerY-40}" width="${yardRX-yardLX}" height="80" fill="url(#diagonalHatch)" />
            <line x1="${yardLX}" y1="${CONFIG.centerY-40}" x2="${yardLX}" y2="${CONFIG.centerY+40}" stroke="#ed8936" stroke-width="2" stroke-dasharray="4,2"/>
            <line x1="${yardRX}" y1="${CONFIG.centerY-40}" x2="${yardRX}" y2="${CONFIG.centerY+40}" stroke="#ed8936" stroke-width="2" stroke-dasharray="4,2"/>
            <text x="${(yardLX+yardRX)/2}" y="${CONFIG.centerY-50}" font-size="14" fill="#ed8936" font-weight="bold" text-anchor="middle">æ¢åœº K26+700~900</text>
            
            <!-- æ¢åœºå†…éƒ¨æ•°æ® -->
            <g transform="translate(${(yardLX+yardRX)/2}, ${CONFIG.centerY+60})" text-anchor="middle" font-family="Consolas">
                <text y="0" font-size="14" fill="#ed8936" font-weight="bold">â­•ï¸ 8</text>
                <text y="20" font-size="14" fill="#ed8936" font-weight="bold">ğŸ“¦ 2</text>
                <text y="40" font-size="14" fill="#ed8936" font-weight="bold">ğŸŒ‰ 2</text>
            </g>
        `;

        // --- 5. ç»˜åˆ¶èŠ‚ç‚¹ä¸è·¯åŸº ---
        let currentX = getX(15236);
        let lastBridgeTextX = -999; // ç”¨äºè®°å½•ä¸Šä¸€ä¸ªæ¡¥æ¢é…æ¢æ–‡å­—çš„Xä½ç½®ï¼Œé˜²æ­¢é‡å 

        DATA.forEach((item, index) => {
            if (item.type === 'node') {
                const x = getX(item.k);
                const color = '#2d3748';
                if(item.icon === 'start') {
                    html += `<circle cx="${x}" cy="${CONFIG.centerY}" r="6" fill="${color}" />`;
                    html += `<text x="${x}" y="${CONFIG.centerY-20}" font-size="12" font-weight="bold" fill="${color}" text-anchor="middle">${item.label}</text>`;
                } else {
                    html += `<rect x="${x-2}" y="${CONFIG.centerY-10}" width="4" height="20" fill="${color}" />`;
                    html += `<text x="${x}" y="${CONFIG.centerY-20}" font-size="12" font-weight="bold" fill="${color}" text-anchor="middle">${item.label}</text>`;
                }
                currentX = x;
            } 
            else if (item.type === 'bridge') {
                const x = getX(item.k);
                const isP1 = item.k < CONFIG.yardStart;
                const color = isP1 ? 'var(--phase1-color)' : 'var(--phase2-color)';
                const iconSize = item.isMajor ? 12 : 8;
                
                // --- æ™ºèƒ½é˜²é‡å é€»è¾‘ ---
                let beamTextY = CONFIG.centerY + 60; // é»˜è®¤é«˜åº¦
                // å¦‚æœå½“å‰æ¡¥æ¢ä¸ä¸Šä¸€ä¸ªæ¡¥æ¢é…æ¢æ–‡å­—è·ç¦»å°äº80åƒç´ ï¼Œåˆ™å‘ä¸‹é”™ä½
                if (Math.abs(x - lastBridgeTextX) < 80) {
                    beamTextY += 25; // é”™ä½é«˜åº¦
                }
                lastBridgeTextX = x; // æ›´æ–°ä½ç½®è®°å½•
                
                html += `
                    <g class="hover-elem" data-tip="${item.name}<br>${item.desc}">
                        <line x1="${x}" y1="${CONFIG.centerY}" x2="${x}" y2="${CONFIG.centerY-40}" stroke="${color}" stroke-width="1" stroke-dasharray="2,2" />
                        <rect x="${x-iconSize}" y="${CONFIG.centerY-iconSize}" width="${iconSize*2}" height="${iconSize*2}" transform="rotate(45, ${x}, ${CONFIG.centerY})" fill="${item.isMajor?'#fff':color}" stroke="${color}" stroke-width="3" />
                        
                        <!-- æ¡¥æ¢åç§° (ä¸Šæ–¹) -->
                        <text x="${x}" y="${CONFIG.centerY-45}" font-size="${item.isMajor?13:11}" font-weight="${item.isMajor?'bold':'normal'}" fill="${color}" text-anchor="middle" transform="rotate(-15, ${x}, ${CONFIG.centerY-45})">${item.name}</text>
                        
                        <!-- é‡ç‚¹æ ‡è¯† (ä¸‹æ–¹é¿è®©) -->
                        ${item.isMajor ? `<text x="${x}" y="${CONFIG.centerY+37}" font-size="10" fill="${color}" text-anchor="middle" font-weight="bold">â˜…é‡ç‚¹</text>` : ''}
                    </g>
                `;

                // --- é…æ¢æ•°æ®ç»˜åˆ¶ (æ”¯æŒå¤šè¡Œ) ---
                if (Array.isArray(item.beams)) {
                    // å¤šè¡Œæ•°æ® (å¦‚ç‰¹å¤§æ¡¥)
                    item.beams.forEach((line, i) => {
                        html += `<text x="${x}" y="${beamTextY + (i * 14)}" font-size="11" fill="${color}" text-anchor="middle" font-weight="bold" font-family="Arial">${line}</text>`;
                    });
                } else {
                    // å•è¡Œæ•°æ®
                    html += `<text x="${x}" y="${beamTextY}" font-size="11" fill="${color}" text-anchor="middle" font-weight="bold" font-family="Arial">${item.beams}</text>`;
                }

                currentX = x;
            }
            else if (item.type === 'road') {
                const lenPx = (item.len / (CONFIG.maxK - CONFIG.minK)) * (CONFIG.svgWidth - 100);
                const centerX = currentX + lenPx / 2;
                const isP1 = centerX < getX(CONFIG.yardStart);
                const color = isP1 ? '#e53e3e' : '#3182ce';
                
                html += `
                    <g class="hover-elem" data-tip="è·¯åŸºé•¿: ${item.len}m">
                        <g transform="translate(${centerX}, ${CONFIG.centerY+20})" text-anchor="middle" font-family="Consolas">
                            <text y="0" font-size="14" fill="${color}" font-weight="bold">â­•ï¸ ${item.info.pipe}</text>
                            <text y="20" font-size="14" fill="${color}" font-weight="bold">ğŸ“¦ ${item.info.box}</text>
                            <text y="40" font-size="14" fill="${color}" font-weight="bold">ğŸŒ‰ ${item.info.bridge}</text>
                        </g>
                        ${item.isLong ? `<text x="${centerX}" y="${CONFIG.centerY+75}" font-size="12" fill="#d69e2e" font-weight="bold" text-anchor="middle">âš ï¸ è¶…é•¿è¿è·</text>` : ''}
                    </g>
                `;
                
                if(item.isLong) {
                    html += `<rect x="${currentX}" y="${CONFIG.centerY+3}" width="${lenPx}" height="4" fill="#fbd38d" opacity="0.6" />`;
                }
                currentX += lenPx;
            }
        });

        // --- 6. é¡¶éƒ¨ç»Ÿè®¡æ•°æ® ---
        const p1X = getX(20000);
        html += `
            <g transform="translate(${p1X}, 40)">
                <text y="0" font-size="18" font-weight="bold" fill="var(--phase1-color)" text-anchor="middle">â—€ ç¬¬ä¸€é˜¶æ®µ (å…±826ç‰‡)</text>
                <text y="20" font-size="12" fill="var(--phase1-color)" text-anchor="middle">13m:308 | 25m:478 | 35m:40</text>
                <line x1="-150" y1="30" x2="150" y2="30" stroke="var(--phase1-color)" stroke-width="3" marker-start="url(#arrowRed)" />
            </g>
        `;
        
        const p2X = getX(34000);
        html += `
            <g transform="translate(${p2X}, 40)">
                <text y="0" font-size="18" font-weight="bold" fill="var(--phase2-color)" text-anchor="middle">ç¬¬äºŒé˜¶æ®µ (å…±258ç‰‡) â–¶</text>
                <text y="20" font-size="12" fill="var(--phase2-color)" text-anchor="middle">13m:198 | 25m:60</text>
                <line x1="-150" y1="30" x2="150" y2="30" stroke="var(--phase2-color)" stroke-width="3" marker-end="url(#arrowBlue)" />
            </g>
        `;

        svg.innerHTML = html;

        document.querySelectorAll('.hover-elem').forEach(el => {
            el.addEventListener('mousemove', (e) => {
                const tip = e.currentTarget.getAttribute('data-tip');
                tooltip.style.display = 'block';
                tooltip.innerHTML = tip;
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
            });
            el.addEventListener('mouseleave', () => {
                tooltip.style.display = 'none';
            });
        });
        
        setTimeout(() => {
            const container = document.querySelector('.panorama-scroll-view');
            container.scrollLeft = getX(CONFIG.yardStart) - container.clientWidth / 2;
        }, 100);
    }

    window.onload = renderMap;
    window.onresize = renderMap;

</script>
</body>
</html>